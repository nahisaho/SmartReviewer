# 源内AI環境 連携要件確認書

## SmartReviewer - 庁内AI環境（源内）連携

---

**文書管理情報**
- 文書ID: ENV-001
- バージョン: 1.0.0
- 作成日: 2026-01-06
- ステータス: 確認待ち

---

## 1. 確認の目的

SmartReviewer プロジェクトにおいて、庁内AI環境（源内）との連携を実現するために必要な技術要件を確認する。

---

## 2. 確認事項一覧

### 2.1 API仕様

| # | 確認項目 | 確認内容 | 回答欄 |
|---|----------|----------|--------|
| 1-1 | APIエンドポイント | ベースURL、利用可能なエンドポイント一覧 | |
| 1-2 | 認証方式 | APIキー / OAuth / Bearer Token 等 | |
| 1-3 | リクエスト形式 | OpenAI互換 / 独自形式 | |
| 1-4 | レスポンス形式 | JSON / Streaming対応有無 | |
| 1-5 | API仕様書 | 提供可能かどうか | |

### 2.2 利用可能モデル

| # | 確認項目 | 確認内容 | 回答欄 |
|---|----------|----------|--------|
| 2-1 | LLMモデル一覧 | 利用可能なLLMモデル名 | |
| 2-2 | 推奨モデル | 本プロジェクトに推奨されるモデル | |
| 2-3 | Embeddingモデル | 利用可能なEmbeddingモデル | |
| 2-4 | コンテキスト長 | 各モデルの最大コンテキスト長 | |
| 2-5 | 日本語性能 | 日本語処理の精度・推奨設定 | |

### 2.3 制限事項

| # | 確認項目 | 確認内容 | 回答欄 |
|---|----------|----------|--------|
| 3-1 | レート制限 | リクエスト数/分、トークン数/日 等 | |
| 3-2 | クォータ | プロジェクト単位の利用上限 | |
| 3-3 | 同時接続数 | 並列リクエストの上限 | |
| 3-4 | タイムアウト | リクエストタイムアウト設定 | |
| 3-5 | ファイルサイズ | 入力の最大サイズ制限 | |

### 2.4 セキュリティ要件

| # | 確認項目 | 確認内容 | 回答欄 |
|---|----------|----------|--------|
| 4-1 | データ保持 | 入出力データの保持期間・削除ポリシー | |
| 4-2 | 学習利用 | 入力データがモデル学習に利用されるか | |
| 4-3 | アクセス制御 | IPホワイトリスト、VPN要件等 | |
| 4-4 | 監査ログ | APIアクセスログの取得方法 | |
| 4-5 | 暗号化 | 通信の暗号化要件（TLS等） | |

### 2.5 UI/UX制約

| # | 確認項目 | 確認内容 | 回答欄 |
|---|----------|----------|--------|
| 5-1 | 既存UI統合 | 源内の既存UIへの統合要件 | |
| 5-2 | 入力形式 | 対応する入力形式（テキスト、ファイル等） | |
| 5-3 | 出力形式 | 対応する出力形式 | |
| 5-4 | ユーザー認証 | ユーザー認証との連携方式 | |
| 5-5 | カスタムUI | 独自UIの構築可否 | |

### 2.6 開発・テスト環境

| # | 確認項目 | 確認内容 | 回答欄 |
|---|----------|----------|--------|
| 6-1 | 開発環境 | 開発用の環境提供有無 | |
| 6-2 | テスト用クォータ | 開発・テスト用の別クォータ | |
| 6-3 | サンドボックス | 本番影響のないテスト環境 | |
| 6-4 | アクセス申請 | 環境へのアクセス申請プロセス | |
| 6-5 | 開発者ドキュメント | 開発者向けドキュメントの提供 | |

---

## 3. SmartReviewer側の連携方式

### 3.1 MCP Sampling アーキテクチャ

SmartReviewerでは、MCP (Model Context Protocol) の **Sampling** 機能を活用して源内と連携します。

```
┌─────────────────────────────────────────────────────────────┐
│                    SmartReviewer MCP Host                   │
│                                                             │
│  ┌───────────────────────────────────────────────────────┐ │
│  │                  Sampling Handler                      │ │
│  │                                                        │ │
│  │  • LLM API呼び出しの実行                              │ │
│  │  • 認証情報の管理                                      │ │
│  │  • エラーハンドリング                                  │ │
│  │  • レート制限対応                                      │ │
│  └───────────────────────────────────────────────────────┘ │
│                            │                                │
│                            │ HTTPS                          │
│                            ▼                                │
│  ┌───────────────────────────────────────────────────────┐ │
│  │              源内 AI環境 API                           │ │
│  │                                                        │ │
│  │  • LLM推論エンドポイント                              │ │
│  │  • Embeddingエンドポイント                            │ │
│  └───────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 連携フロー

```
1. MCP Server (smartreviewer-core) が Sampling リクエストを発行
   └─ 例: review_document Tool 実行中に LLM 推論が必要
   
2. MCP Host が Sampling リクエストを受信
   └─ Server側にはLLM認証情報を持たせない（セキュリティ）
   
3. MCP Host が源内 API を呼び出し
   └─ Host側で認証、エラーハンドリング
   
4. 源内からのレスポンスを MCP Server に返却
   └─ Server は結果を使って処理を継続
```

### 3.3 必要な連携パターン

| パターン | 用途 | 想定リクエスト数/件 |
|----------|------|---------------------|
| テキスト生成 | レビュー結果、是正提案生成 | 10-50回 |
| 分類・判定 | チェック項目の合否判定 | 10-20回 |
| 要約 | 大容量文書の事前要約 | 1-5回 |
| Embedding | ベクトル検索用埋め込み生成 | 50-100回（初期構築時） |

---

## 4. 想定するAPI利用パターン

### 4.1 テキスト生成（Chat Completion相当）

```json
// リクエスト例（OpenAI互換形式の場合）
{
  "model": "gennai-base",
  "messages": [
    {
      "role": "system",
      "content": "あなたはドキュメントレビューの専門家です。"
    },
    {
      "role": "user", 
      "content": "以下の設計書について、「用語の一貫性」の観点でレビューしてください。\n\n[設計書本文...]"
    }
  ],
  "temperature": 0,
  "max_tokens": 2000
}
```

### 4.2 Embedding生成

```json
// リクエスト例
{
  "model": "gennai-embedding",
  "input": "システム全体のアーキテクチャを定義する..."
}
```

---

## 5. 確認スケジュール

| 日程 | アクション |
|------|------------|
| Week 1 | 本確認書の送付、初回ミーティング設定 |
| Week 1-2 | 回答受領、追加確認 |
| Week 2 | 連携方式の確定、開発環境アクセス取得 |
| Week 3 | 連携テスト実施 |

---

## 6. 回答フォーマット

ご回答は本ドキュメントの「回答欄」に直接記入いただくか、
別途ドキュメントにてご提供ください。

**ご不明点・ご質問がございましたら、お気軽にお問い合わせください。**

---

## 付録: MCP Sampling 仕様参考

MCP Sampling の詳細仕様:
https://modelcontextprotocol.io/docs/concepts/sampling

```typescript
// MCP Sampling リクエスト例
interface SamplingRequest {
  method: "sampling/createMessage";
  params: {
    messages: Message[];
    modelPreferences?: {
      hints?: ModelHint[];
      costPriority?: number;
      speedPriority?: number;
      intelligencePriority?: number;
    };
    systemPrompt?: string;
    includeContext?: "none" | "thisServer" | "allServers";
    temperature?: number;
    maxTokens: number;
    stopSequences?: string[];
  };
}
```

---

**変更履歴**

| バージョン | 日付 | 変更内容 |
|------------|------|----------|
| 1.0.0 | 2026-01-06 | 初版作成 |
